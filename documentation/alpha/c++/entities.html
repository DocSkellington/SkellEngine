<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SkellEngine: How entities work</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SkellEngine
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">2D homemade game engine using JSON and Lua to ease game development</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">How entities work </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#entities_creation">Creation</a></li>
<li class="level1"><a href="#entities_get_remove">Get and remove an entity</a></li>
<li class="level1"><a href="#entities_components">Components</a></li>
<li class="level1"><a href="#entities_examples">Example</a><ul><li class="level2"><a href="#entities_examples_cpp">C++</a></li>
<li class="level2"><a href="#entities_examples_lua">Lua</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>In our ECS architecture, an entity is an object that contains components. Each entity has a <em>type</em>, for example, <code>player</code>; multiple entities can share the same type. The entities are managed by the Entity Manager which has a list with every entity currently in the engine. In Lua, the Entity Manager can be accessed through <code>game.entityManager</code>, while in C++, it can be accessed with a reference to the Context.</p>
<h1><a class="anchor" id="entities_creation"></a>
Creation</h1>
<p>The Entity Manager allows for creating new entities with the function <code>addEntity</code>. The new entity can be initiliased:</p><ul>
<li>As empty. In this case, the user must add the components and, then, add the entity to the System Manager.</li>
<li>With a JSON table describing the components to add to the entity. In this case, the entity is immediately added to the System Manager.</li>
</ul>
<h1><a class="anchor" id="entities_get_remove"></a>
Get and remove an entity</h1>
<p>The user can retrieve an entity from the Entity Manager in two ways:</p><ul>
<li>By providing only the <code>type</code> of the entity.</li>
<li>By providing the <code>type</code> and a list of components the entity must have (the entity can have other components).</li>
</ul>
<p>In both cases, the function is called <code>getEntity</code> and the first found matching entity is returned.</p>
<p>Finally, the user can remove an entity from the Entity Manager with <code>removeEntity</code> and, therefore, from the game as the manager removes it from the systems, too. In Lua scripts, the variable used to store the entity will not (immediately?) be set to nil. So, I highly recommend you to do it yourself.</p>
<h1><a class="anchor" id="entities_components"></a>
Components</h1>
<p>Once the user has a reference to an entity, it's possible to add a new component (<code>addComponent</code>), check if the entity has a specific component (<code>hasComponent</code>) and to get a component (<code>getComponent</code>). It's impossible to remove a component.</p>
<p>It's also possible to iterate over the components.</p>
<h1><a class="anchor" id="entities_examples"></a>
Example</h1>
<p>Here are full examples with creating, getting and removing entities.</p>
<h2><a class="anchor" id="entities_examples_cpp"></a>
C++</h2>
<p>In this example, we suppose we have the <code>context</code> variable as a reference to the Context of the engine. </p><div class="fragment"><div class="line"><span class="comment">// First, we create an empty entity</span></div><div class="line"><span class="keyword">auto</span> entity = context.entityManager-&gt;addEntity(<span class="stringliteral">&quot;newEntity&quot;</span>);</div><div class="line"><span class="comment">// We then add a position component with default values</span></div><div class="line"><span class="keyword">auto</span> position = entity-&gt;addComponent(<span class="stringliteral">&quot;position&quot;</span>);</div><div class="line">position-&gt;set(<span class="stringliteral">&quot;x&quot;</span>, 5.1);</div><div class="line">position-&gt;set(<span class="stringliteral">&quot;y&quot;</span>, 9);</div><div class="line"><span class="comment">// The three lines can be remplaced by:</span></div><div class="line">entity-&gt;addComponent(<span class="stringliteral">&quot;position&quot;</span>, {5.1, 9});</div><div class="line"><span class="comment">// or by:</span></div><div class="line">entity-&gt;addComponent(<span class="stringliteral">&quot;position&quot;</span>, {{<span class="stringliteral">&quot;x&quot;</span>, 5.1}, {<span class="stringliteral">&quot;y&quot;</span>, 9}});</div><div class="line"><span class="comment">// Don&#39;t forget to add it to the System Manager</span></div><div class="line">context.systemManager-&gt;addEntity(entity);</div><div class="line"></div><div class="line"><span class="comment">// We can iterate over the components</span></div><div class="line"><span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;itr : entity) {</div><div class="line">  <span class="keywordflow">if</span> (itr.first == <span class="stringliteral">&quot;position&quot;</span>) {</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;We have a position, Houston\n&quot;</span>;</div><div class="line">  }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Now, we create an entity with a position component</span></div><div class="line">context.entityManager-&gt;addEntity(<span class="stringliteral">&quot;entityPosition&quot;</span>, {{<span class="stringliteral">&quot;position&quot;</span>, {48, 91.7}}});</div><div class="line"><span class="comment">// In this case, that&#39;s all you have to do. Of course, the function returns a reference to the created entity if you need to keep a direct access.</span></div><div class="line"></div><div class="line"><span class="comment">// Let&#39;s get the &#39;entityPosition&#39;</span></div><div class="line"><span class="keyword">auto</span> entityPosition = context.entityManager-&gt;getEntity(<span class="stringliteral">&quot;entityPosition&quot;</span>);</div><div class="line"><span class="comment">// You can filter more entities by doing</span></div><div class="line"><span class="keyword">auto</span> entityPosition = context.entityManager-&gt;getEntity(<span class="stringliteral">&quot;entityPosition&quot;</span>, {<span class="stringliteral">&quot;position&quot;</span>, <span class="stringliteral">&quot;other&quot;</span>, <span class="stringliteral">&quot;component&quot;</span>}) <span class="comment">// it will only look after an &#39;entityPosition&#39; with at least the three components (so, in this example, it will be an empty pointer as &#39;entityPosition&#39; does not have &#39;other&#39; and &#39;component&#39; components)</span></div><div class="line"></div><div class="line"><span class="comment">// Eventually, we remove the &#39;entityPosition&#39; entity from the engine</span></div><div class="line">context.entityManager-&gt;removeEntity(entityPosition)</div></div><!-- fragment --><h2><a class="anchor" id="entities_examples_lua"></a>
Lua</h2>
<div class="fragment"><div class="line">-- First, we create an empty entity</div><div class="line">entity = game.entityManager:addEntity(&quot;newEntity&quot;)</div><div class="line">-- We then add a position component with default values</div><div class="line">position = entity:addComponent(&quot;position&quot;)</div><div class="line">position:set(&quot;x&quot;, 5.1)</div><div class="line">position:set(&quot;y&quot;, 9)</div><div class="line">-- The three lines can be remplaced by entity:addComponent(&quot;position&quot;, {x=5.1, y=9}) or by entity:addComponent(&quot;position&quot;, {5.1, 9})</div><div class="line">-- Don&#39;t forget to add it to the System Manager</div><div class="line">game.systemManager:addEntity(entity)</div><div class="line"></div><div class="line">--- We can iterate over the components</div><div class="line">for name, component in pairs(entity) do</div><div class="line">  if name == &quot;position&quot;</div><div class="line">    std::cout &lt;&lt; &quot;We have a position, Houston\n&quot;;</div><div class="line">  end</div><div class="line">end</div><div class="line"></div><div class="line">-- Now, we create an entity with a position component</div><div class="line">game.entityManager:addEntity(&quot;entityPosition&quot;, {position={48, 91.7}})</div><div class="line">-- In this case, that&#39;s all you have to do. Of course, the function returns a reference to the created entity if you need to keep a direct access.</div><div class="line"></div><div class="line">-- Let&#39;s get the &#39;entityPosition&#39;</div><div class="line">entityPosition = game.entityManager:getEntity(&quot;entityPosition&quot;)</div><div class="line">-- You can filter more entities by doing</div><div class="line">entityPosition = game.entityManager:getEntity(&quot;entityPosition&quot;, {&quot;position&quot;, &quot;other&quot;, &quot;component&quot;}) -- it will only look after an &#39;entityPosition&#39; with at least the three components (so, in this example, it will be nil as &#39;entityPosition&#39; does not have &#39;other&#39; and &#39;component&#39; components)</div><div class="line"></div><div class="line">-- Eventually, we remove the &#39;entityPosition&#39; entity from the engine</div><div class="line">game.entityManager:removeEntity(entityPosition)</div><div class="line">-- we set entityPosition to nil</div><div class="line">entityPosition = nil</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
